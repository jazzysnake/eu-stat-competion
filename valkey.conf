# Bind to all interfaces inside the container to allow connections via the mapped port
bind 0.0.0.0

# Default port
port 6379

# --- Security ---
# Require clients to authenticate using the password specified.
# We'll get the actual password from an environment variable set via docker-compose.
# Valkey >= 7 supports getting config from ENV vars using ${VAR_NAME} syntax
# If using older Valkey/Redis image syntax, you might need to inject it differently or use entrypoint scripts.
# Check your specific Valkey image version documentation if this doesn't work.
requirepass changeme

# --- Persistence ---
# Directory where RDB/AOF files will be stored. MUST match the volume mount point.
dir /data

# Enable RDB persistence (snapshotting)
# Save the DB if at least 1 key changed in 900 seconds (15 minutes)
save 900 1
# Save the DB if at least 10 keys changed in 300 seconds (5 minutes)
save 300 10
# Save the DB if at least 10000 keys changed in 60 seconds (1 minute)
save 60 10000

# Enable AOF persistence (Append Only File - logs every write operation)
# Often provides better durability than RDB alone. Choose based on your needs.
appendonly yes
appendfilename "appendonly.aof"
# appendfsync everysec # 'everysec' is a good balance of performance/safety. Options: no, always, everysec.

# --- Memory Management ---
# Set a memory limit (e.g., 256MB). Adjust as needed.
maxmemory 256mb
# Eviction policy when maxmemory is reached (e.g., remove least recently used keys)
# Other options: volatile-lru, allkeys-random, volatile-random, volatile-ttl, noeviction
maxmemory-policy allkeys-lru

# --- Logging ---
# Log to stdout/stderr to be captured by Docker logs
logfile ""
loglevel notice
